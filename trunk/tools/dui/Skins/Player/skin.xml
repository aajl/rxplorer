<?xml version="1.0" encoding="utf-8"?>
<directui>
	<script type="javascript" file="dialog.js" />
	<script type="javascript" file="player.js" />
	<script type="javascript">
		<![CDATA[
		var timer_play_pos = 0;
		var show_cursor = true;
		var prev_cursor_x = 0;
		var prev_cursor_y = 0;
		var cursor_count = 0;
		
		function open_file()
		{
			var filepath = dialog.open();
			play_file(filepath);
		}
		
		function play_file(filepath)
		{
			show_cursor = true;
			prev_cursor_x = 0;
			prev_cursor_y = 0;
			
			var ret = player.play(filepath);
			if(ret == "true")
			{
				logo.hide();
				play_progress.enable(true);
				set_video_pos();
				openfile.hide();
				play_time.show();
				play.check(true);
				var duration = player.duration();
				if(duration == 0)
				{
					play_progress.set_range(0, 100);
					footer_play_progress.set_range(0, 100);
				}
				else
				{
					play_progress.set_range(0, duration);
					footer_play_progress.set_range(0, duration);
				}
				
				filename.text = filepath.substr(filepath.lastIndexOf('\\') + 1);
				timer_play_pos = window.setInterval(1000, 'get_play_pos()');
			}
		}
		
		function stop_play()
		{
			var full = player.get_fullscreen();
			if(full)
				player.set_fullscreen(Number(!full));

			filename.text = "";
			logo.show();
			footer.show();
			play.check(false);
			openfile.show();
			play_time.hide();
			play_progress.pos = 0;
			footer_play_progress.pos = 0;
			play_progress.enable(false);
			footer_ctrl_bar.hide();
			player.stop();
		}
		
		function set_video_pos()
		{
			player.set_video_pos(videowindow.x, videowindow.y, videowindow.width, videowindow.height);
		}
		
		function set_play_pos(play_prgrs)
		{
			var duration = player.duration();
			if(duration == 0)
				return;
			
			player.set_play_pos(play_prgrs.pos);
		}
		
		function get_play_pos()
		{
			var duration = player.duration();
			if(duration == 0)
				return;
			
			var full = player.get_fullscreen();
			if(full)
			{
				var pt = window.cursor_pos();
				if(prev_cursor_x == pt.x && prev_cursor_y == pt.y)
				{
					if(show_cursor && ++cursor_count == 5)
					{
						show_cursor = false;
						window.show_cursor(false);
						footer_ctrl_bar.hide();
					}				
				}
				else
				{
					cursor_count = 0;
					prev_cursor_x = pt.x;
					prev_cursor_y = pt.y;
				}
			}
			
			var playpos = player.get_play_pos();
			play_progress.pos = playpos;
			footer_play_progress.pos = playpos;
			
			function fmt(tt)
			{
				return tt < 10 ? '0' + tt : tt;
			}

			var hh = parseInt(playpos / 3600);
			var mm = parseInt((playpos / 60) % 60);
			var ss = parseInt(playpos % 60);
			var text = fmt(hh) + ":" + fmt(mm) + ":" + fmt(ss) + " / ";
			hh = parseInt(duration / 3600);
			mm = parseInt((duration / 60) % 60);
			ss = parseInt(duration % 60);
			text += fmt(hh) + ":" + fmt(mm) + ":" + fmt(ss);
			play_time.text = text;
			footer_play_time.text = text;
			
			if(duration == playpos)
			{
				stop_play();
				window.clearInterval(timer_play_pos);
			}
		}
		
		function show_ctrl_bar()
		{
			if(show_cursor)
				return;
				
			var pt = window.cursor_pos();
			if(prev_cursor_x == pt.x && prev_cursor_y == pt.y)
				return;

			cursor_count = 0;
			show_cursor = true;
			prev_cursor_x = 0;
			prev_cursor_y = 0;
			window.show_cursor(true);
			footer_ctrl_bar.show();
		}
		
		function change_volume(volume_ctrl)
		{
			var pos = volume_ctrl.pos;
			player.set_volume(pos);
		}
		
		function move_main_menu()
		{
			if(menu.popuped)
				return;

			var rc_menu_btn = menu.screen_rect();
			var rc_main_menu = main_menu.rect();
			var top = rc_menu_btn.top + rc_menu_btn.height + 4;
			main_menu.move(rc_menu_btn.left, top, rc_main_menu.width, rc_main_menu.height);
		}
		
		function drop_files(files)
		{
			if(files.length == 0)
				return;
				
			play_file(files[0]);
		}
		
		function fullscreen()
		{
			var full = !player.get_fullscreen();
			if(!player.set_fullscreen(Number(full)))
				return;
				
			if(full)
			{
				var rc_ctrl_bar = footer_ctrl_bar.rect();
				var rc_player = dplayer.screen_rect();
				var left = rc_player.left;
				var top = rc_player.top + rc_player.height - rc_ctrl_bar.height;
				footer_ctrl_bar.move(left, top, rc_player.width, rc_ctrl_bar.height);			
				
				footer.hide();
				footer_ctrl_bar.show();
			}
			else
			{
				footer.show();
				footer_ctrl_bar.hide();
			}
		}
		]]>
	</script>

	<imgs id="imgs" main_normal="main_normal.png" main_hover="main_hover.png">
		<imgs openas_normal="openas_normal.png" openas_hover="openas_hover.png" />
	</imgs>

	<fonts id="fonts">
		<font id="default" size="10" face="新宋体" />
		<font id="bold_10" size="10" weight="700" />
		<font id="bold_8" size="8" weight="700" />
		<font id="about_dplayer" size="13" weight="700" />
		<font id="song_10" size="10" face="新宋体" />
		<font id="song_8" size="8" face="新宋体" />
		<font id="arial_8" size="8" face="Arial" />
	</fonts>
	
	<scroll type="vertical">
		<states normal="imgs.images">
			<normal x="11" y="36" />
			<hover x="11" y="36" />
			<down x="11" y="36" />
			<disabled x="11" y="36" />
		</states>
	</scroll>

	<panel id="dplayer" title="DPlayer" type="app" bkimg="" drag="true">
		<events maximize="max.check(true)" restore="max.check(0)" drop="drop_files()" />
		<size x="0" y="0" width="611" height="425" resize="true" min-width="611" min-height="425" />
		<eresize>
			<top x="463" y="0" width="10" height="24" />
			<left x="0" y="24" width="1" height="20" />
			<right x="610" y="24" width="1" height="20" />
			<bottom_left x="3" y="377" width="121" height="48" />
			<bottom_right x="486" y="377" width="66" height="48" />
		</eresize>
		<hittest>
			<rect x="0" y="0" width="470" height="24" />
		</hittest>

		<img src="imgs.main_hover" x="80" y="0" width="531" height="23" adapt="true" float="width">
			<image x="x" y="y" width="5" height="height" />
		</img>

		<label id="title" text="DPlayer" x="0" y="0" width="80" height="23" color="#c2c2c2" font="fonts.bold_10">
			<attribs bkimg="imgs.main_hover" offset="24" align="left,vcenter,singleline" />
			<image x="x" y="y" width="width" height="height" />
		</label>
		
		<label id="filename" text="" x="80" y="0" width="415" height="23" color="#c2c2c2" font="fonts.bold_8">
			<attribs bkimg="imgs.main_hover" float="width" align="center,vcenter,singleline" />
			<image x="x" y="y" width="width" height="height" />
		</label>
		
		<!--系统按钮-->
		<layer id="sys" x="501" y="1" width="110" height="21" float="right" margin="0,4">
			<button id="menu" action="move_main_menu();" x="0" y="0" width="19" height="19" popup="main_menu">
				<states normal="imgs.main_hover" dy="2" y="32" width="19" height="19">
					<normal x="444" />
					<hover x="463" />
					<down x="482" />
				</state>
			</button>

			<button id="min" action="window.min()" x="0" y="0" width="19" height="19">
				<states normal="imgs.main_hover" dy="2" y="32" width="19" height="19">
					<normal x="502" />
					<hover x="521" />
					<down x="540" />
				</state>
			</button>

			<button id="max" action="window.max()" x="0" y="0" width="19" height="19" checkable="true">
				<states normal="imgs.main_hover" dy="2" y="52" width="19" height="19">
					<normal x="444" />
					<hover x="463" />
					<down x="482" />
				</state>
				<states normal="imgs.main_hover" dy="2" y="52" width="19" height="19">
					<normal x="502" />
					<hover x="521" />
					<down x="540" />
				</state>
			</button>
			
			<button id="close" action="window.close()" x="0" y="0" width="38" height="21">
				<states normal="imgs.main_hover" y="72" width="38" height="21">
					<normal x="444" />
					<hover x="482" />
					<down x="520" />
				</state>
			</button>
		</layer>

		<!--视频窗口-->
		<panel id="videowindow" type="" x="1" y="24" width="609" height="341" bkclr="#141414" float="width,height">
			<events resize="set_video_pos();" dbclk="fullscreen()" mouse_move="show_ctrl_bar()" />

			<layer id="logo_panel" float="center,vcenter">
				<!--logo-->
				<!--img id="logo" src="logo.png" x="127" y="44" width="357" height="165" /-->
				<img id="logo" src="walle.png" x="241" y="70" width="128" height="128" />
												
				<!--弹出窗口-->
				<panel id="dlg_open_as" visible="false" bkimg="imgs.openas_normal">
					<size x="237" y="260" width="138" height="77" />
					<effect show="effect.roll(dlg_open_as.id, 100, true, 2)" clip="this">
						<clip x="" y="" width="" height="" />
					</effect>
					
					<button action="openas.popup();open_file();" position="relative" x="5" y="5" width="129" height="23">
						<attribs text="打开本地文件" align="center,vcenter,singleline" color="#959595" />
						<states normal="imgs.openas_normal" hover="imgs.openas_hover" x="5" y="5">
						</states>
					</button>
					
					<button action="openas.popup();" position="relative" x="5" y="34" width="129" height="23">
						<attribs text="打开URL" align="center,vcenter,singleline" color="#959595" />			
						<states normal="imgs.openas_normal" hover="imgs.openas_hover" x="5" y="34">
						</states>
					</button>
				</panel>

				<!--主页上的打开按钮-->
				<layer id="openfile" x="236" y="214">
					<button id="open" action="open_file()" x="236" y="214" width="108" height="45">
						<states normal="imgs.main_hover" x="232" width="108" height="45">
							<normal y="109"  />
							<hover y="155" />
						</state>
					</button>
					
					<button id="openas" x="344" y="214" width="31" height="45">
						<attribs popup="javascript:dlg_open_as.id" />
						<states normal="imgs.main_hover" y="63" width="31" height="45">
							<normal x="232" />
							<hover x="263" />
							<down x="294" />
						</state>
					</button>
				</layer>
			</layer>
		</panel>
		
		<img src="imgs.main_hover" x="1" y="365" width="609" height="60" adapt="true" float="width,bottom">
			<image x="15" y="y" width="5" height="height" />
		</img>
		
		<img src="imgs.main_hover" x="124" y="377" width="365" height="42" adapt="true" float="center,bottom">
			<image x="x" y="y" width="width" height="height" />
		</img>

		<layer id="prgrs" visible="false">
			<img src="imgs.main_hover" width="2" height="8" float="bottom">
				<image x="20" y="356" width="2" height="8" />
			</img>
			<img src="imgs.main_hover" width="2" height="8" adapt="true" float="width,bottom">
				<image x="28" y="356" width="2" height="8" />
			</img>
			<img src="imgs.main_hover" width="2" height="8" float="right,bottom">
				<image x="589" y="356" width="2" height="8" />
			</img>
		</layer>
		
		<layer id="prgrs_down" visible="false">
			<img src="imgs.main_hover" width="1" height="8" float="bottom">
				<image x="20" y="369" width="1" height="8" />
			</img>
			<img src="imgs.main_hover" width="2" height="8" adapt="true" float="width,bottom">
				<image x="28" y="369" width="2" height="8" />
			</img>
			<img src="imgs.main_hover" width="1" height="8" float="right,bottom">
				<image x="590" y="369" width="1" height="8" />
			</img>
		</layer>

		<layer id="footer">
			<progress id="play_progress" x="20" y="369" width="572" height="8" range="0,100" pos="0">
				<attribs float="width,bottom" enable="false" />
				<slider x="16" y="31" width="15" height="5" img="imgs.main_hover" />
				<events track="set_play_pos(play_progress)" tracking="" />
				<states>
					<normal link="javascript:prgrs.id" />
					<down link="javascript:prgrs_down.id" />
				</states>
			</progress>

			<label id="play_time" text="00:00:00 / 00:00:00" visible="false" x="20" y="395" width="120" height="20">
				<attribs bkimg="imgs.main_hover" font="fonts.arial_8" color="#c2c2c2" float="bottom" />
				<image x="20" y="395" width="120" height="20" />
			</label>
			
			<!--播放控制-->
			<layer id="play_ctrl" x="305" float="center,bottom">
				<button id="stop" action="stop_play();" x="177" y="389" width="17" height="17">
					<states normal="imgs.main_hover" y="71" width="17" height="17">
						<normal x="16" />
						<hover x="33" />
						<down x="50" />
					</state>
				</button>

				<button id="prev" action="" x="218" y="388" width="19" height="19">
					<states normal="imgs.main_hover" y="71" width="19" height="19">
						<normal x="68" />
						<hover x="87" />
						<down x="106" />
					</state>
				</button>

				<button id="play" action="player.pause()" x="258" y="380" width="32" height="32" checkable="true">
					<states normal="imgs.main_hover" y="38" width="32" height="32">
						<normal x="113" />
						<hover x="145" />
						<down x="177" />
					</state>
					<states normal="imgs.main_hover" y="38" width="32" height="32">
						<normal x="16" />
						<hover x="48" />
						<down x="80" />
					</state>
				</button>

				<button id="next" action="" x="308" y="388" width="19" height="19">
					<states normal="imgs.main_hover" y="71" width="19" height="19">
						<normal x="126" />
						<hover x="145" />
						<down x="164" />
					</state>
				</button>

				<button id="mute" action="player.mute();" x="355" y="387" width="20" height="20" checkable="true">
					<states normal="imgs.main_hover" y="91" width="20" height="20">
						<normal x="15" />
						<hover x="35" />
						<down x="55" />
					</state>
					<states normal="imgs.main_hover" y="91" width="20" height="20">
						<normal x="76" />
						<hover x="96" />
						<down x="116" />
					</state>
				</button>
				
				<progress id="volume" x="380" y="396" width="60" height="8" range="0,100" pos="100">
					<slider x="16" y="31" width="15" height="5" img="imgs.main_hover" />
					<events track="change_volume(volume)" />
					<states>
						<normal link="javascript:prgrs.id" />
						<down link="javascript:prgrs_down.id" />
					</states>
				</progress>
			</layer>
			
			<!--截图及播放列表-->
			<layer x="556" y="394" width="55" height="20" margin="5" float="right,bottom">
				<button id="" action="player.set_channel(++channel % 3);" x="0" y="0" width="20" height="19">
					<states normal="imgs.main_hover" y="112" width="20" height="19">
						<normal x="444" />
						<hover x="464" />
						<down x="484" />
					</state>
				</button>
				<button id="playlist" action="" x="0" y="0" width="20" height="19" checkable="true">
					<states normal="imgs.main_hover" y="112" width="20" height="19">
						<normal x="505" />
						<hover x="525" />
						<down x="545" />
					</state>
					<states normal="imgs.main_hover" y="132" width="20" height="19">
						<normal x="505" />
						<hover x="525" />
						<down x="545" />
					</state>
				</button>
			</layer>
		</layer> <!-- end footer -->
	</panel> <!-- end dplayer -->
	
	<!--全屏时的底部控制栏-->
	<panel id="footer_ctrl_bar" type="modeless" visible="false" x="0" y="430" width="611" height="60">
	
		<img src="imgs.main_hover" x="0" y="0" width="611" height="60" adapt="true" float="width,bottom">
			<image x="15" y="365" width="5" height="height" />
		</img>

		<img src="imgs.main_hover" x="124" y="12" width="365" height="42" adapt="true" float="center,bottom">
			<image x="x" y="377" width="width" height="height" />
		</img>

		<progress id="footer_play_progress" x="20" y="4" width="572" height="8" range="0,100" pos="0">
			<attribs float="width,bottom" enable="true" />
			<slider x="16" y="31" width="15" height="5" img="imgs.main_hover" />
			<events track="set_play_pos(footer_play_progress)" tracking="" />
			<states>
				<normal link="javascript:prgrs.id" />
				<down link="javascript:prgrs_down.id" />
			</states>
		</progress>

		<label id="footer_play_time" text="00:00:00 / 00:00:00" visible="true" x="20" y="30" width="120" height="20">
			<attribs bkimg="imgs.main_hover" font="fonts.arial_8" color="#c2c2c2" float="bottom" />
			<image x="20" y="395" width="120" height="20" />
		</label>
		
		<layer id="" x="305" float="center,bottom">
				<button id="" action="stop_play();" x="177" y="24" width="17" height="17">
					<states normal="imgs.main_hover" y="71" width="17" height="17">
						<normal x="16" />
						<hover x="33" />
						<down x="51" />
					</state>
				</button>

				<button id="" action="" x="218" y="23" width="19" height="19">
					<states normal="imgs.main_hover" y="71" width="19" height="19">
						<normal x="68" />
						<hover x="87" />
						<down x="106" />
					</state>
				</button>

				<button id="" action="player.pause()" x="258" y="17" width="32" height="32" checkable="true">
					<states normal="imgs.main_hover" y="38" width="32" height="32">
						<normal x="113" />
						<hover x="145" />
						<down x="177" />
					</state>
					<states normal="imgs.main_hover" y="38" width="32" height="32">
						<normal x="16" />
						<hover x="48" />
						<down x="80" />
					</state>
				</button>

				<button id="" action="" x="308" y="23" width="19" height="19">
					<states normal="imgs.main_hover" y="71" width="19" height="19">
						<normal x="126" />
						<hover x="145" />
						<down x="164" />
					</state>
				</button>

				<button id="" action="player.mute();" x="355" y="22" width="20" height="20" checkable="true">
					<states normal="imgs.main_hover" y="91" width="20" height="20">
						<normal x="15" />
						<hover x="35" />
						<down x="55" />
					</state>
					<states normal="imgs.main_hover" y="91" width="20" height="20">
						<normal x="76" />
						<hover x="96" />
						<down x="116" />
					</state>
				</button>
				
				<progress id="footer_volume" x="380" y="31" width="60" height="8" range="0,100" pos="100">
					<slider x="16" y="31" width="15" height="5" img="imgs.main_hover" />
					<events track="change_volume(footer_volume)" />
					<states>
						<normal link="javascript:prgrs.id" />
						<down link="javascript:prgrs_down.id" />
					</states>
				</progress>
			</layer>
	</panel>
	
	<menu id="main_menu" x="504" y="24" width="126" height="145" visible="false" alpha="80" bkclr="#ffffff" margin="1,0,0,0">
		<border width="1" color="#aca899" />
		
		<items height="23">
			<item id="menu_file" text="文件" img="imgs.main_hover" src="submenu.png" x="444" y="32"
				  mouse_in="menu_file.show()" mouse_out="menu_file.hide()">
				<item text="打开文件" action="menu.popup();open_file()" />
				<item text="打开URL" />
				<separator />
				<item text="文件信息" />
			</item>
			<item id="menu_play" text="播放" src="submenu.png"
				  mouse_in="menu_play.show()" mouse_out="menu_play.hide()">
				<item text="播放/暂停" />
				<item text="停止" />
			</item>
			<item id="menu_display" text="显示" img="imgs.main_hover" src="submenu.png" x="444" y="52"
				  mouse_in="menu_display.show()" mouse_out="menu_display.hide()">
				<item text="全屏" />
				<item text="普通模式" />
				<separator />
				<item text="播放时置顶" />
				<item text="总时置顶" />
				<item text="取消置顶" />
			</item>
			<item id="menu_channel" text="声道" src="submenu.png"
				  mouse_in="menu_channel.show()" mouse_out="menu_channel.hide()">
				<item text="左声道" action="player.set_channel(0);menu.popup()" />
				<item text="右声道" action="player.set_channel(1);menu.popup()"/>
				<item text="立体声" action="player.set_channel(2);menu.popup()"/>
			</item>
			<item id="menu_setting" text="设置" />
			<separator />
			<item id="menu_about" text="关于DPlayer" action="menu.popup();about.show()" />
			<item id="menu_exit" text="退出" img="close.png" x="0" y="0" action="dplayer.close()" />
		</items>
		
		<layer x="0" y="0" width="122" height="23" action="item.action">
			<events mouse_in="item.mouse_in" mouse_out="item.mouse_out" />
			<states>
				<normal border="0" bkclr="#ffffff" />
				<hover border="0" bkclr="#d2d2d2" />
				<down border="0" bkclr="#d2d2d2" />
			</states>

			<label bkimg="item.img" x="0" y="0" width="122" height="23">
				<attribs text="item.text" offset="23" align="singleline,vcenter" />
				<image x="item.x" y="item.y" width="19" height="19" dx="2" dy="2" />
			</label>
			<img src="item.src" position="relative" x="110" y="8" width="7" height="7" />
		</layer>
	</menu>

	<!--关于对话框-->
	<panel id="about" type="modal" visible="false" bkimg="about.png" alpha="95">
		<size x="0" y="0" width="375" height="283" />
		<hittest>
			<rect x="0" y="0" width="330" height="24" />
		</hittest>
		
		<label text="关于DPlayer" x="24" y="4" width="180" height="20" color="#c2c2c2" font="fonts.bold_8" />

		<label text="DPlayer" x="14" y="44" width="180" height="28" size="13" weight="700" />

		<label text="Beta 1.0.11.21" x="20" y="75" width="100" height="20" font="fonts.song_10" />

		<label x="18" y="133" width="400" height="60" font111="fonts.song_10">
			<text>
				Tristar 版权所有
				Copyright (C) 2011 Tristar. All Rights Reserved.
			</text>
		</label>

		<button action="window.close()" x="330" y="1" width="38" height="21">
			<states normal="imgs.main_hover" y="72" width="38" height="21">
				<normal x="444" />
				<hover x="482" />
				<down x="520" />
			</state>
		</button>
		
		<button text="确定" action="window.close()" x="295" y="251" width="59" height="24">
			<attribs align="singleline,center,vcenter" />
			<states normal="imgs.main_hover" y="38" width="59" height="24">
				<normal x="232" />
				<hover x="291" />
				<down x="350" />
			</state>
		</button>
	</panel>

</directui>